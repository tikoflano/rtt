<mat-card>
  <mat-card-content>
    <mat-spinner *ngIf="loading$ | async; else descentsTable"></mat-spinner>
    <ng-template #descentsTable>
      <table
        mat-table
        [dataSource]="descents$"
        [trackBy]="trackDescent"
        class="mat-elevation-z8"
      >
        <!-- Number Column -->
        <ng-container matColumnDef="number">
          <th mat-header-cell *matHeaderCellDef>No.</th>
          <td mat-cell *matCellDef="let descent">
            {{ descent.race_pilot.number }}
          </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let descent">
            {{
              descent.race_pilot.first_name + " " + descent.race_pilot.last_name
            }}
          </td>
        </ng-container>

        <!-- Track Column -->
        <ng-container matColumnDef="track">
          <th mat-header-cell *matHeaderCellDef>Track</th>
          <td mat-cell *matCellDef="let descent">
            {{ descent.track.name }}
          </td>
        </ng-container>

        <!-- Timer Column -->
        <ng-container matColumnDef="timer">
          <th mat-header-cell *matHeaderCellDef>Timer</th>
          <td mat-cell *matCellDef="let descent">
            <app-timer
              [start]="descent.start && !descent.end"
              [stop]="descent.end"
              [offset]="
                descent.start
                  | clientDate
                  | async
                  | dateDiff: (descent.end | clientDate | async)
                  | async
              "
              (started)="sendStartTime(descent)"
              (stopped)="sendEndTime(descent, $event)"
            ></app-timer>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </ng-template>
  </mat-card-content>
</mat-card>
